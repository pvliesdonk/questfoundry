name: grow_phase4b_narrative_gaps
description: Identify missing beats in path sequences

system: |
  You are analyzing path beat sequences to find narrative gaps --
  places where the story jumps too abruptly between beats.

  ## Beat Ordering (CRITICAL — read this first)
  after_beat = the EARLIER beat (the new beat goes AFTER it)
  before_beat = the LATER beat (the new beat goes BEFORE it)

  The new beat is inserted BETWEEN after_beat and before_beat.
  after_beat MUST appear earlier in the path sequence than before_beat.

  ## What is a Narrative Gap?
  A gap occurs when a path's beat sequence lacks a natural transition:
  - Setup → climax (missing development/escalation)
  - Decision → consequence (missing reaction/processing)
  - Introduction → commitment (missing exploration)

  ## Gap Detection Checklist
  1. Jump in narrative intensity? (setup to climax with nothing between)
  2. Missing emotional transition? (big decision to next action without reflection)
  3. Default to sequel type for gap beats — use scene only when the gap
     requires concrete action (travel, visible choice)
  4. Gap beats should be concise transitions, not major story events
  5. Maximum 2 gap beats per path

  ## Path Sequences (in execution order)
  {path_sequences}

  ## What NOT to Do
  - Do NOT propose gaps for paths with only 1-2 beats
  - Do NOT propose gaps between beats that already flow naturally
  - Do NOT use IDs not listed in the Valid IDs section
  - Do NOT swap after_beat and before_beat — after_beat is ALWAYS earlier
  - Do NOT add prose before or after the JSON output

  ## Valid IDs
  Valid path_ids: {valid_path_ids}
  Valid beat_ids (for after_beat/before_beat): {valid_beat_ids}

  ## Output Format
  Return a JSON object with a "gaps" array. Each gap has:
  - path_id: the path (prefixed form, e.g., "path::dilemma__answer")
  - after_beat: the EARLIER beat (or null for start of path)
  - before_beat: the LATER beat (or null for end of path)
  - summary: concise description of the gap beat (1 sentence)
  - scene_type: scene | sequel | micro_beat (default: sequel)

  If no gaps are needed, return an empty gaps array.

user: |
  Analyze the path sequences above and propose gap beats where needed.

  REMINDER: Return ONLY a valid JSON object. Use ONLY IDs from the Valid IDs section.
  REMINDER: after_beat is the EARLIER beat, before_beat is the LATER beat. Do NOT reverse them.

components: []
