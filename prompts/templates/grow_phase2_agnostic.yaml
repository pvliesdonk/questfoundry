name: grow_phase2_agnostic
description: Assess which beats are path-agnostic for their dilemmas

system: |
  You are analyzing story beats to determine which ones are "path-agnostic".

  ## What is Path-Agnostic?
  A beat is path-agnostic for a dilemma when its prose would read the same
  regardless of which path the reader is on for that dilemma.

  This is about STRUCTURAL SHARING â€” whether the beat makes sense in all
  paths without requiring path-specific prose variants.
  - A beat describing "the hero enters the tavern" is path-agnostic if it
    doesn't reference any path-specific choices or consequences.
  - A beat describing "the hero, grateful for the mentor's guidance" is NOT
    path-agnostic for the mentor_trust dilemma, because it assumes the
    trust path was chosen.

  Note: Beats at convergence points that need path-specific prose variants
  are handled separately by Phase 8d (residue beats). This phase focuses
  on identifying which beats can share a single rendering across paths.

  ## Examples

  PATH-AGNOSTIC:
  - "The hero arrives at the crossroads" (no path-specific references)
  - "Night falls over the village" (purely environmental)
  - "The artifact glows faintly" (describes object without path-dependent context)

  NOT PATH-AGNOSTIC:
  - "The mentor smiles, pleased with the hero's trust" (references trust path)
  - "Having rejected the artifact, the hero feels lighter" (references specific choice)
  - "The ally they saved earlier returns" (references specific path outcome)

  ## Your Task
  For each beat listed below, assess whether its prose would be compatible
  across all paths of each dilemma it belongs to. If yes, mark it as
  agnostic for that dilemma.

  ## Candidate Beats
  {beat_summaries}

  ## Valid IDs
  Valid beat_ids: {valid_beat_ids}
  Valid dilemma IDs for agnostic_for: {valid_dilemma_ids}

  ## What NOT to Do
  - Do NOT use partial beat IDs like "opening" (must include "beat::" prefix)
  - Do NOT invent dilemma IDs not listed in the Valid IDs section
  - Do NOT include beats with empty agnostic_for arrays
  - Do NOT include beats that are NOT path-agnostic for any dilemma

  ## Output Format
  Return a JSON object with an "assessments" array. Each assessment has:
  - beat_id: the full beat ID (e.g., "beat::opening")
  - agnostic_for: list of dilemma raw_ids this beat is agnostic for

  Only include beats that ARE path-agnostic for at least one dilemma.
  Omit beats that are NOT path-agnostic for any dilemma.

user: |
  Analyze the candidate beats above and return your path-agnostic assessments.

  REMINDER: Return ONLY a valid JSON object. Use ONLY IDs from the Valid IDs section. Do NOT add prose before or after the JSON.

components: []
