name: serialize_seed_sections
description: Section-specific prompts for iterative SEED serialization

# Section 1: Entity Decisions
entities_prompt: |
  You are generating ENTITY DECISIONS for a SEED stage.

  ## Generation Requirements (CRITICAL)
  You MUST generate a decision for EVERY entity ID in the manifest below.
  Missing items WILL cause validation failure. This is NOT extraction - you must
  generate decisions for ALL entities, even if the brief doesn't mention them explicitly.

  ## Schema
  Return a JSON object with an "entities" array. Each item is an EntityDecision:
  ```json
  {
    "entities": [
      {
        "entity_id": "entity_id_from_brainstorm",
        "disposition": "retained" or "cut"
      }
    ]
  }
  ```

  ## Rules
  - disposition must be exactly "retained" or "cut" (lowercase)
  - entity_id must match EXACTLY an ID from the Entity IDs manifest
  - Generate a decision for EVERY entity in the manifest

  ## What NOT to Do
  - Do NOT skip entities because they aren't mentioned in the brief
  - Do NOT invent entities not in the manifest
  - Do NOT partially complete the list

  ## Output
  Return ONLY valid JSON with the "entities" array.

# Section 2: Tension Decisions
tensions_prompt: |
  You are generating TENSION DECISIONS for a SEED stage.

  ## Generation Requirements (CRITICAL)
  You MUST generate a decision for EVERY tension ID in the manifest below.
  Missing items WILL cause validation failure. This is NOT extraction - you must
  generate decisions for ALL tensions, even if the brief doesn't mention them explicitly.

  ## Schema
  Return a JSON object with a "tensions" array. Each item is a TensionDecision:
  ```json
  {
    "tensions": [
      {
        "tension_id": "tension_id_from_brainstorm",
        "explored": ["alt_id_1", "alt_id_2"],
        "implicit": ["alt_id_3"]
      }
    ]
  }
  ```

  ## Rules
  - tension_id must match EXACTLY an ID from the Tension IDs manifest
  - explored: Alternative IDs that become threads (MUST include the default path)
  - implicit: Alternative IDs NOT explored (become shadows)
  - Generate a decision for EVERY tension in the manifest

  ## What NOT to Do
  - Do NOT skip tensions because they aren't mentioned in the brief
  - Do NOT invent tensions not in the manifest
  - Do NOT partially complete the list

  ## Output
  Return ONLY valid JSON with the "tensions" array.

# Section 3: Threads
threads_prompt: |
  You are generating THREADS for a SEED stage based on tension decisions.

  ## Generation Requirements (CRITICAL)
  For each "explored" alternative in the tension decisions, you MUST generate a thread.
  Each thread represents one storyline path that will be developed in the story.

  ## Schema
  Return a JSON object with a "threads" array. Each item is a Thread:
  ```json
  {
    "threads": [
      {
        "thread_id": "unique_thread_id",
        "name": "Human Readable Thread Name",
        "tension_id": "which_tension",
        "alternative_id": "which_alternative_this_explores",
        "unexplored_alternative_ids": ["unexplored_alt_ids"],
        "thread_importance": "major" or "minor",
        "description": "What this thread is about",
        "consequence_ids": ["consequence_id_1"]
      }
    ]
  }
  ```

  ## Thread ID Naming (CRITICAL)

  Thread IDs must be DIFFERENT from tension IDs. Use short descriptive names.

  FORMAT:
  - Tension: `[subject]_[optionA]_or_[optionB]` (the binary question)
  - Thread: `[subject]_[aspect]` (short storyline name)

  Pattern examples (generate YOUR OWN based on your story):
  - Tension about character loyalty → Thread: `[character]_loyalty`
  - Tension about artifact's nature → Thread: `[artifact]_secret`
  - Tension about faction's agenda → Thread: `[faction]_agenda`

  BAD patterns (will cause validation failures):
  - Using the SAME ID for both tension and thread
  - Using the tension_id as the thread_id

  Thread IDs should be short names for the storyline, NOT the binary question.

  **DO NOT copy example IDs** - generate IDs specific to YOUR story.

  ## Rules
  - thread_importance must be exactly "major" or "minor" (lowercase)
  - unexplored_alternative_ids: IDs of alternatives NOT explored (implicit ones)
  - consequence_ids: References to consequences for this thread
  - Generate a thread for EACH explored alternative from tension decisions

  ## What NOT to Do
  - Do NOT reuse tension IDs as thread IDs
  - Do NOT skip alternatives marked as "explored"
  - Do NOT create threads for "implicit" alternatives (they become shadows, not threads)

  ## Output
  Return ONLY valid JSON with the "threads" array.

# Section 4: Consequences
consequences_prompt: |
  You are generating CONSEQUENCES for a SEED stage based on threads.

  ## Generation Requirements (CRITICAL)
  Every thread MUST have at least one consequence. Consequences describe the narrative
  outcomes that result from following a particular thread's storyline.

  ## Schema
  Return a JSON object with a "consequences" array. Each item is a Consequence:
  ```json
  {
    "consequences": [
      {
        "consequence_id": "unique_consequence_id",
        "thread_id": "which_thread_this_belongs_to",
        "description": "What happens narratively",
        "narrative_effects": ["story effect 1", "story effect 2"]
      }
    ]
  }
  ```

  ## Rules
  - consequence_id must be unique
  - thread_id must reference a thread from the VALID THREAD IDs list
  - narrative_effects: Array of story effects this consequence implies
  - Generate at least one consequence for EACH thread

  ## What NOT to Do
  - Do NOT reference thread IDs that don't exist
  - Do NOT leave any thread without consequences
  - Do NOT invent consequence_ids that don't follow the naming convention

  ## Output
  Return ONLY valid JSON with the "consequences" array.

# Section 5: Initial Beats
beats_prompt: |
  You are generating INITIAL BEATS for a SEED stage.

  ## Generation Requirements (CRITICAL)
  Generate 2-4 initial beats PER THREAD. If there are 3 threads, expect 6-12 beats total.
  Beats must use ONLY valid IDs from the manifest - no invented or derived IDs.

  ## CRITICAL: ID CONSTRAINTS (read first!)

  The brief contains valid ID lists. You MUST copy IDs exactly from these lists:
  - `## VALID THREAD IDs` - use ONLY these in `threads` arrays
  - `### Entity IDs` - use ONLY these in `entities` and `location` fields

  WRONG examples that WILL FAIL:
  - `"clock_distortion"` - NOT a valid thread (derived from concept)
  - `"the_garden"` - WRONG, use `"garden"` (no prefix)
  - `"murder_intent"` - This is a tension ID, not a thread ID

  ## Schema
  Return a JSON object with an "initial_beats" array:
  ```json
  {
    "initial_beats": [
      {
        "beat_id": "unique_beat_id",
        "summary": "What happens in this beat",
        "threads": ["thread::[your_thread_id]", "thread::[another_thread]"],
        "tension_impacts": [
          {
            "tension_id": "tension::[your_tension_id]",
            "effect": "advances",
            "note": "Explanation of the impact"
          }
        ],
        "entities": ["entity::[character_id]", "entity::[location_id]"],
        "location": "entity::[location_id]",
        "location_alternatives": ["entity::[other_location]"]
      }
    ]
  }
  ```

  **Use IDs from YOUR story's manifest** - the examples above show the FORMAT only.

  ## Rules
  - effect must be exactly "advances", "reveals", "commits", or "complicates"
  - threads: Array of thread IDs from the VALID THREAD IDs list ONLY
  - entities: Array of entity IDs from the Entity IDs list ONLY
  - location: Entity ID from locations list (can be null)
  - location_alternatives: Other valid location IDs (can be empty array)
  - Generate 2-4 beats for EACH thread in the VALID THREAD IDs list

  ## BEAT COUNT PRESERVATION (CRITICAL)

  If you receive validation feedback about invalid IDs, DO NOT reduce your beat count.
  Instead:
  1. Keep the SAME number of beats and their narrative structure
  2. Fix ONLY the invalid ID references
  3. Replace invented IDs with valid IDs from the manifest

  Common fixes:
  - `entity::guard` (invented) → use an actual character from Entity IDs
  - `entity::character_office` (invented) → use a location from the manifest
  - `thread::concept_name` (derived) → use exact thread ID from VALID THREAD IDs

  Your beat count should stay at 2-4 beats per thread.
  Producing fewer than 2 beats per thread WILL fail validation.

  ## LOCATION vs ENTITY DISAMBIGUATION

  The `location` field accepts ONLY location-category entities from the Entity IDs manifest.
  DO NOT invent locations - use only IDs from the Entity IDs list that are locations.
  The `entities` field accepts characters, objects, and factions (NOT locations).

  WRONG:
  ```json
  "entities": ["entity::hero", "entity::castle"],  // castle is a location!
  "location": "entity::magic_sword"                // sword is an object!
  ```

  RIGHT:
  ```json
  "entities": ["entity::hero", "entity::magic_sword"],
  "location": "entity::castle"
  ```

  ## What NOT to Do
  - Do NOT derive thread IDs from tension names or concepts
  - Do NOT add prefixes like "the_" to entity IDs
  - Do NOT generate fewer than 2 beats per thread
  - Do NOT reference IDs not in the manifest lists

  ## FINAL CHECK (verify before output)
  Before returning JSON, check each beat:
  1. Every `threads` item appears EXACTLY in the ## VALID THREAD IDs list (copy-paste, don't retype)
  2. Every `entities` item appears in the ### Entity IDs list
  3. `location` appears in the Locations section
  4. No invented IDs, no prefixes added

  ## Output
  Return ONLY valid JSON with the "initial_beats" array.

# Section 6: Convergence Sketch
convergence_prompt: |
  You are extracting the CONVERGENCE SKETCH from a SEED stage brief.

  ## Schema
  Return a JSON object with a "convergence_sketch" object:
  ```json
  {
    "convergence_sketch": {
      "convergence_points": ["where threads should merge"],
      "residue_notes": ["differences that persist after convergence"]
    }
  }
  ```

  ## Rules
  - convergence_points: Where threads should merge (e.g., "by act 2 climax")
  - residue_notes: What differences persist after convergence
  - Both can be empty arrays if not specified in brief

  ## Output
  Return ONLY valid JSON with the "convergence_sketch" object.

components: []
