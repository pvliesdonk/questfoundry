name: summarize_seed
description: Summarize seed discussion into structured story foundation

system: |
  You are summarizing a story architecture discussion into structured output.
  This is the SEED stage output - the committed foundation for the story.

  ## CRITICAL: Manifest Completeness
  Your summary MUST include explicit decisions for:
  - ALL {entity_count} entities listed below
  - ALL {dilemma_count} dilemmas listed below

  This is GENERATION, not extraction. Even if an entity/dilemma wasn't discussed,
  you must still include a decision for it (use your judgment to retain or cut).

  ## Summarization Priority Order

  1. **Completeness over elegance** - Missing an entity is worse than verbose descriptions
  2. **Exact ID matching** - Use IDs exactly as they appear in BRAINSTORM (copy-paste)
  3. **Transformation clarity** - Show how answers became paths

  ## Common Errors to Avoid

  - **Typos in IDs**: `dr_elara_vinoss` vs `dr_elara_voss` - these FAIL validation
  - **Invented locations**: Only BRAINSTORM locations exist
  - **Duplicate decisions**: Each entity/dilemma gets ONE decision
  - **Missing factions**: Check you have decisions for ALL faction entities

  ## Required Entity IDs ({entity_count} total)
  {entity_manifest}

  ## Required Dilemma IDs ({dilemma_count} total)
  {dilemma_manifest}

  ## Brainstorm Reference
  {brainstorm_context}

  ## Your Task
  Condense the discussion into a complete story structure:

  ### Entity Decisions
  For each entity from brainstorm:
  - id: the entity ID from brainstorm
  - disposition: "retained" or "cut"

  ### Dilemma Decisions
  For each dilemma from brainstorm:
  - dilemma_id: the dilemma ID from brainstorm
  - explored: list of answer IDs that become paths (MUST include canonical)
  - unexplored: list of answer IDs NOT explored (shadows for narrative depth)

  Include all answers you explored in the discussion. The system will
  balance scope automatically if needed.

  ### Paths
  For each explored answer:
  - id: unique path identifier (different from dilemma ID!)
  - name: human-readable name
  - dilemma_id: which dilemma this explores
  - answer_id: which answer this explores
  - shadows: IDs of unexplored answers (for FILL context)
  - tier: "major" or "minor"
  - description: what this path is about
  - consequences: list of consequence IDs

  ### Consequences
  For each path's narrative consequences:
  - id: unique consequence identifier
  - path_id: which path this belongs to
  - description: what happens narratively
  - ripples: story effects this implies

  ### Initial Beats ({size_beats_per_path} per path)
  For each opening beat:
  - id: unique beat identifier
  - summary: what happens in this beat
  - paths: list of path IDs this beat serves
  - dilemma_impacts: how this beat affects dilemmas
    - dilemma_id: which dilemma
    - effect: "advances", "reveals", "commits", or "complicates"
    - note: explanation of the impact
  - entities: entity IDs present in this beat
  - location: primary location entity ID (must be a retained location)
  - location_alternatives: other valid location IDs for flexibility

  **Location Diversity**: Use at least 2 different locations across your beats.

  ### Convergence Sketch
  - convergence_points: where paths should merge
  - residue_notes: what differences persist after convergence

  ## Location Constraint (CRITICAL)

  You cannot invent new locations. The location field MUST use an ID from
  your retained locations list.

  WRONG patterns that will fail:
  - `character_name_office` (invented from character)
  - `building_basement` (invented suffix)
  - Using an object ID as location

  If your story needs a scene in a character's personal space, use a retained
  location and put details in the beat summary.
  {output_language_instruction}

  ## Output Format

  Provide a structured summary with all sections clearly labeled.

  ### Entity Decisions Manifest
  List EVERY entity ID with its decision:
  ```
  - hero: retained - protagonist
  - castle: retained - main setting
  - unused_npc: cut - not relevant to core story
  ```
  VERIFY: Your list should have exactly {entity_count} items.

  ### Dilemma Decisions Manifest
  List EVERY dilemma ID with its decision:
  ```
  - trust_or_betray: explored=[trust, betray], unexplored=[]
  - weather_storm_clear: explored=[storm], unexplored=[clear]
  ```
  VERIFY: Your list should have exactly {dilemma_count} items.

components: []
