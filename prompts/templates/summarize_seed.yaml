name: summarize_seed
description: Summarize seed discussion into structured story foundation

system: |
  You are summarizing a story architecture discussion into structured output.
  This is the SEED stage output - the committed foundation for the story.

  ## CRITICAL: Manifest Completeness (read first!)
  Your summary MUST include explicit decisions for:
  - ALL {entity_count} entities listed below
  - ALL {tension_count} tensions listed below

  This is GENERATION, not extraction. Even if an entity/tension wasn't discussed,
  you must still include a decision for it (use your judgment to retain or cut).

  ## Summarization Priority Order

  When condensing the discussion, prioritize:

  1. **Completeness over elegance** - Missing an entity is worse than verbose descriptions
  2. **Exact ID matching** - Use IDs exactly as they appear in BRAINSTORM (copy-paste)
  3. **Transformation clarity** - Show how alternatives became threads (not just list threads)

  ## Common Summarization Errors to Avoid

  - **Typos in IDs**: `dr_elara_vinoss` vs `dr_elara_voss` - these FAIL validation
  - **Invented locations**: You cannot create `character_office` or `building_basement` - only BRAINSTORM locations exist
  - **Duplicate decisions**: Each entity gets ONE decision, each tension gets ONE decision
  - **Missing factions**: Factions are easy to forget - check you have decisions for ALL faction entities

  ## Required Entity IDs ({entity_count} total - MUST all appear in output)
  {entity_manifest}

  ## Required Tension IDs ({tension_count} total - MUST all appear in output)
  {tension_manifest}

  ## Brainstorm Reference
  {brainstorm_context}

  ## Your Task
  Condense the discussion into a complete story structure:

  ### Entity Decisions
  For each entity from brainstorm:
  - id: the entity ID from brainstorm
  - disposition: "retained" or "cut"

  ### Tension Decisions (CRITICAL for Arc Count)
  For each tension from brainstorm:
  - tension_id: the tension ID from brainstorm
  - explored: list of alternative IDs that become threads (MUST include canonical)
  - implicit: list of alternative IDs NOT explored (context for shadows)

  **Arc Count Requirement**: Arc count = 2^n where n = tensions with BOTH alternatives explored.
  - To create 4+ arcs (minimum for real IF), explore BOTH alternatives for at least 2 tensions.
  - To create 8 arcs (ideal), explore BOTH alternatives for 3 tensions.
  - Exploring only canonical alternatives = 1 arc = LINEAR STORY (not acceptable for IF).

  ### Threads
  For each explored alternative:
  - id: unique thread identifier
  - name: human-readable name
  - tension_id: which tension this explores
  - alternative_id: which alternative this explores
  - shadows: IDs of unexplored alternatives (for FILL context)
  - tier: "major" or "minor"
  - description: what this thread is about
  - consequences: list of consequence IDs

  ### Consequences
  For each thread's narrative consequences:
  - id: unique consequence identifier
  - thread_id: which thread this belongs to
  - description: what happens narratively
  - ripples: story effects this implies

  ### Initial Beats (2-4 per thread) - CRITICAL
  Create 2-4 initial beats PER THREAD (not just 1 total).
  With 3 threads, expect 6-12 beats. Each thread needs multiple entry points.

  **This is non-negotiable**: If you have 3 threads, you need at least 6 beats.

  For each opening beat:
  - id: unique beat identifier
  - summary: what happens in this beat
  - threads: list of thread IDs this beat serves
  - tension_impacts: how this beat affects tensions
    - tension_id: which tension
    - effect: "advances", "reveals", "commits", or "complicates"
    - note: explanation of the impact
  - entities: entity IDs present in this beat
  - location: primary location entity ID (must be a retained location)
  - location_alternatives: other valid location IDs for knot flexibility

  **Location Diversity**: Use at least 2 different locations across your beats.
  Locations can be shared across threads. Don't place all beats in one setting - vary locations for scene contrast and pacing.

  ### Convergence Sketch
  - convergence_points: where threads should merge
  - residue_notes: what differences persist after convergence

  ## Guidelines
  - Be complete - capture ALL decisions discussed
  - Entity IDs must match those from brainstorm
  - Every tension must have a decision (explored vs implicit)
  - Canonical alternative MUST be in the explored list
  - Every thread needs at least one consequence
  - Use clear, consistent IDs (snake_case recommended)

  ## PRE-BEAT CHECKLIST (verify before writing beats)

  Before writing initial beats, list your available options:

  1. **Retained Locations** (you should have at least 2 locations):
     List the location IDs you marked as "retained" - these are your ONLY valid location choices.

  2. **Retained Characters** (for entities field):
     List the character IDs you marked as "retained" - beats should feature these characters.

  3. **Beat Math**:
     - You have N threads (count them)
     - Each needs 2-4 beats
     - Total beats needed: 2N to 4N

  ## LOCATION CONSTRAINT (CRITICAL)

  You cannot invent new locations. The location field MUST use an ID from your retained locations list.

  WRONG patterns that will fail:
  - `character_name_office` (invented from character)
  - `building_basement` (invented suffix)
  - Using an object ID as location

  If your story needs a scene in a character's personal space, use a retained location and put details in the beat summary.

  ## FINAL CHECK (verify before submitting)
  COUNT your output before submitting:
  - Entity decisions: Do you have exactly {entity_count} decisions?
  - Tension decisions: Do you have exactly {tension_count} decisions?
  - Beat count: Did you create 2-4 beats PER thread? (3 threads = 6-12 beats)
  - Location diversity: Are you using at least 2 different locations across all beats?

  If your counts don't match, you have missed items. Add them before submitting.

  ## Output Format
  Provide a structured summary with all six sections clearly labeled.
  Use consistent formatting so the serialize phase can extract it accurately.

  ### Entity Decisions Manifest
  List EVERY entity ID with its decision:
  ```
  - hero: retained - protagonist
  - castle: retained - main setting
  - unused_npc: cut - not relevant to core story
  ```
  VERIFY: Your list should have exactly {entity_count} items.

  ### Tension Decisions Manifest
  List EVERY tension ID with its decision:
  ```
  - trust_or_betray: explored=[trust, betray], implicit=[]  # BOTH explored = contributes to branching
  - save_or_abandon: explored=[save, abandon], implicit=[]  # BOTH explored = contributes to branching
  - weather_storm_clear: explored=[storm], implicit=[clear] # Only canonical = no branching from this tension
  ```
  VERIFY: Your list should have exactly {tension_count} items.
  VERIFY: At least 2 tensions should have BOTH alternatives in explored[] for proper IF branching.

components: []
