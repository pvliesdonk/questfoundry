{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://questfoundry.liesdonk.nl/schemas/edit_notes.schema.json",
  "title": "Edit Notes",
  "description": "Generated from 02-dictionary/artifacts/edit_notes_ENRICHED.md. Proposes line-level fixes that remain player-safe and keep structure and canon intact while owners apply the changes in their lanes.",
  "type": "object",
  "properties": {
    "title": {
      "type": "string",
      "description": "Slice name for these edit notes.",
      "minLength": 3,
      "maxLength": 120
    },
    "tu": {
      "type": "string",
      "description": "Origin TU Brief identifier in format TU-YYYY-MM-DD-<role><seq>.",
      "pattern": "^TU-\\d{4}-\\d{2}-\\d{2}-[A-Z]{2,4}\\d{2}$"
    },
    "opened": {
      "$ref": "#/$defs/date_string",
      "description": "Date these edit notes were opened."
    },
    "snapshot": {
      "type": "string",
      "description": "Cold snapshot reference in format \"Cold @ YYYY-MM-DD\".",
      "pattern": "^Cold @ \\d{4}-\\d{2}-\\d{2}$"
    },
    "author": {
      "$ref": "#/$defs/role_name",
      "description": "Role filing the edit notes."
    },
    "owners_to_apply": {
      "type": "array",
      "description": "Roles responsible for applying the fixes; list each owner once.",
      "items": {
        "$ref": "#/$defs/role_name"
      },
      "minItems": 1,
      "uniqueItems": true
    },
    "bars_pressed": {
      "type": "array",
      "description": "Quality bars addressed by these edits.",
      "items": {
        "$ref": "#/$defs/quality_bar"
      },
      "minItems": 1,
      "uniqueItems": true
    },
    "summary": {
      "type": "array",
      "description": "2-4 bullets explaining context, scope limits, ownership, and deferrals.",
      "items": {
        "type": "string",
        "minLength": 10,
        "maxLength": 200
      },
      "minItems": 2,
      "maxItems": 4
    },
    "before_after": {
      "type": "array",
      "description": "Player-safe surgical edit entries with location, issue tag, before/after text, owner, and rationale.",
      "items": {
        "type": "object",
        "properties": {
          "location": {
            "type": "string",
            "description": "Path and anchor for the affected content (format path#anchor).",
            "minLength": 5,
            "maxLength": 200
          },
          "issue_tag": {
            "type": "string",
            "description": "Issue tag identifying the problem (e.g., choice-ambiguity, tone-wobble, accessibility).",
            "minLength": 3,
            "maxLength": 80
          },
          "before_text": {
            "type": "string",
            "description": "Player-safe excerpt before the edit.",
            "minLength": 5,
            "maxLength": 400
          },
          "after_text": {
            "type": "string",
            "description": "Replacement player-safe excerpt after the edit.",
            "minLength": 5,
            "maxLength": 400
          },
          "owner": {
            "type": "string",
            "description": "Role or lane responsible for applying this specific edit.",
            "minLength": 2,
            "maxLength": 80
          },
          "rationale": {
            "type": "string",
            "description": "Why this change is needed and how it preserves safety and canon.",
            "minLength": 5,
            "maxLength": 300
          }
        },
        "required": [
          "location",
          "issue_tag",
          "before_text",
          "after_text",
          "owner",
          "rationale"
        ]
      },
      "minItems": 1
    }
  },
  "required": [
    "title",
    "tu",
    "opened",
    "snapshot",
    "author",
    "owners_to_apply",
    "bars_pressed",
    "summary",
    "before_after"
  ],
  "$defs": {
    "role_name": {
      "type": "string",
      "description": "QuestFoundry role abbreviation (see 02-dictionary/role_abbreviations.md)",
      "enum": [
        "SR",
        "GK",
        "PW",
        "SS",
        "ST",
        "LW",
        "CC",
        "AD",
        "IL",
        "AuD",
        "AuP",
        "TR",
        "BB",
        "PN",
        "RS"
      ]
    },
    "date_string": {
      "type": "string",
      "description": "Date in YYYY-MM-DD format",
      "format": "date",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
    },
    "quality_bar": {
      "type": "string",
      "description": "One of 8 Quality Bars (see taxonomies.md ยง5)",
      "enum": [
        "Integrity",
        "Reachability",
        "Nonlinearity",
        "Gateways",
        "Style",
        "Determinism",
        "Presentation",
        "Accessibility"
      ]
    },
    "loop_name": {
      "type": "string",
      "description": "One of 13 TU loop types (see taxonomies.md ยง3 and loop_names.md)",
      "enum": [
        "Story Spark",
        "Hook Harvest",
        "Lore Deepening",
        "Codex Expansion",
        "Style Tune-up",
        "Art Touch-up",
        "Audio Pass",
        "Translation Pass",
        "Binding Run",
        "Narration Dry-Run",
        "Gatecheck",
        "Post-Mortem",
        "Archive Snapshot"
      ]
    },
    "deferral_tag": {
      "type": "string",
      "description": "Deferral type for dormant roles (see taxonomies.md ยง7)",
      "enum": [
        "deferred:art",
        "deferred:audio",
        "deferred:translation",
        "deferred:research"
      ]
    }
  }
}
